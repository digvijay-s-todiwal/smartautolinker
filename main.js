/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var v=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var $=Object.prototype.hasOwnProperty;var L=(o,i)=>{for(var e in i)v(o,e,{get:i[e],enumerable:!0})},y=(o,i,e,n)=>{if(i&&typeof i=="object"||typeof i=="function")for(let r of I(i))!$.call(o,r)&&r!==e&&v(o,r,{get:()=>i[r],enumerable:!(n=k(i,r))||n.enumerable});return o};var E=o=>y(v({},"__esModule",{value:!0}),o);var C={};L(C,{default:()=>f});module.exports=E(C);var w=require("obsidian"),f=class extends w.Plugin{constructor(){super(...arguments);this.index=new Map;this.intervalId=null}async onload(){console.log("\u{1F517} SmartAutoLinker loaded"),this.app.workspace.onLayoutReady(async()=>{await this.buildIndex()}),this.registerEvent(this.app.workspace.on("editor-change",e=>{this.handleEditorChange(e)})),this.intervalId=window.setInterval(()=>{console.log("\u267B\uFE0F Rebuilding index..."),this.buildIndex()},3e5),this.registerEvent(this.app.vault.on("modify",e=>{e instanceof w.TFile&&e.extension==="md"&&this.buildIndex()}))}onunload(){console.log("\u{1F50C} SmartAutoLinker unloaded"),this.intervalId&&window.clearInterval(this.intervalId)}async buildIndex(){this.index.clear();let e=this.app.vault.getMarkdownFiles();console.log(`\u{1F4C2} Found ${e.length} markdown files`);for(let n of e){let c=(await this.app.vault.read(n)).split(`
`),x=n.basename.trim();this.index.set(x.toLowerCase(),`[[${n.basename}]]`);for(let p of c){let g=p.match(/^(#+)\s+(.*)/);if(g){let a=g[2].trim();this.index.set(a.toLowerCase(),`[[${n.basename}#${a}]]`)}let t=/\^([\w-]+)/g,l;for(;(l=t.exec(p))!==null;){let a=l[1];this.index.set(`^${a.toLowerCase()}`,`[[${n.basename}#^${a}]]`)}}}console.log(`\u{1F50E} Index built with ${this.index.size} entries`)}handleEditorChange(e){let n=e.getCursor(),c=e.getLine(n.line).split(/\s+/),x=c.map(t=>t.toLowerCase()),p=5,g=new Set;for(let t=0;t<c.length;t++)for(let l=p;l>0;l--){if(t+l>c.length)continue;let a=x.slice(t,t+l),m=a.join(" ");if(this.index.has(m)){let d=0;for(let s=0;s<t;s++)d+=c[s].length+1;let u=d+a.join(" ").length;if([...Array(u-d).keys()].some(s=>g.has(d+s)))continue;let b=e.getRange({line:n.line,ch:d},{line:n.line,ch:u}),h=this.index.get(m);if(h.includes("|")||(h=`[[${h.slice(2,-2)}|${c.slice(t,t+l).join(" ")}]]`),b!==h){e.replaceRange(h,{line:n.line,ch:d},{line:n.line,ch:u}),console.log(`\u{1F517} Linked phrase: "${m}" \u2192 ${h}`);for(let s=d;s<u;s++)g.add(s);return}}}}};
